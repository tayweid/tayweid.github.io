---
format:
  revealjs:
    css: custom.css
    transition: none
---

## ECON 0150 | Economic Data Analysis {.center}
<p class="subheader-center">The economist's data analysis skillset.</p>

<br>

### *Part 2.4 | Reshaping Panel Data*

---

## Two Formats, Same Data
<p class="subheader">Recall: panel data can be stored in two ways</p>

<br>

::: {.incremental}
- **Wide format:** Each time period is a separate column
- **Long format:** Each observation is a separate row
- Same information, different shapes
- Different shapes make different tasks easier
:::

---

## Wide Format
<p class="subheader">Each year is a column</p>

![](i/w_01.png)

*> familiar from Part 2.3 — countries as rows, years as columns*

---

## Long Format
<p class="subheader">Each observation is a row</p>

![](i/w_02.png)

*> same data, but now each country-year combination is a row*

---

## The Problem
<p class="subheader">What if our data is in the "wrong" format?</p>

<br>

::: {.incremental}
- Wide format is great for comparing two specific years
- But what if we want to plot consumption **over all years** for one country?
- We need to **reshape** our data
:::

---

## Reshaping: Two Directions
<p class="subheader">We can convert between formats</p>

<br>

::: {.incremental}
- **Wide → Long:** called "melting" or "unpivoting"
- **Long → Wide:** called "pivoting" or "spreading"
- Python pandas: `melt()` and `pivot()`
:::

---

## Melting: Wide → Long
<p class="subheader">Turn columns into rows</p>

![](i/w_03.png)

*> each year column becomes rows in a new "Year" column*

---

## Melting: The Code
<p class="subheader">Use `melt()` to reshape wide → long</p>

```{.python}
# Wide to Long
long_df = wide_df.melt(
    id_vars=['Code'],       # Keep as identifier columns
    var_name='Year',        # Name for the former column headers
    value_name='Consumption' # Name for the values
)
```

. . .

*> `id_vars` = columns to keep, everything else gets melted*

---

## Melting: The Result
<p class="subheader">Now we can plot all years easily</p>

![](i/w_04.png)

. . .

*> long format makes line plots natural — use `hue='Code'`*

---

## Pivoting: Long → Wide
<p class="subheader">Turn rows into columns</p>

![](i/w_05.png)

*> each unique Year value becomes its own column*

---

## Pivoting: The Code
<p class="subheader">Use `pivot()` to reshape long → wide</p>

```{.python}
# Long to Wide
wide_df = long_df.pivot(
    index='Code',           # What becomes rows
    columns='Year',         # What becomes columns
    values='Consumption'    # What fills the cells
)
```

. . .

*> we're back to our original wide format*

---

## Pivoting: The Result
<p class="subheader">Now we can compare specific years easily</p>

![](i/w_06.png)

. . .

*> wide format makes scatterplots of Year1 vs Year2 natural*

---

## When to Use Which Format
<p class="subheader">Choose based on what you're trying to do</p>

<br>

| Task | Better Format |
|------|---------------|
| Line plot over time | Long |
| Faceted plots by group | Long |
| Compare two specific years | Wide |
| Scatterplot (Year1 vs Year2) | Wide |

---

## When to Use Which Format
<p class="subheader">The key insight</p>

<br>

::: {.incremental}
- **Long format:** Good when you want to *group by* or *color by* a variable
- **Wide format:** Good when you want to *compare* or *correlate* specific columns
- Neither is "better" — it depends on your task
:::

---

## Summary
<p class="subheader">Reshaping panel data</p>

<br>

::: {.incremental}
- Panel data can be stored in **wide** or **long** format
- Use `melt()` to go **wide → long** (columns become rows)
- Use `pivot()` to go **long → wide** (rows become columns)
- Choose the format that makes your analysis easier
:::

---

## Exercise 2.4 | Reshaping Coffee Data
<p class="subheader">Practice converting between formats</p>

We'll use the coffee consumption data from Part 2.3.

- **Data:** `Coffee_Per_Cap.csv` (wide format)

---

## Exercise 2.4 | Melt to Long
<p class="subheader">Convert wide format to long format</p>

```{.python}
# Load wide format data
percap = pd.read_csv('data/Coffee_Per_Cap.csv')

# Melt to long format
percap_long = percap.melt(
    id_vars=['Code'],
    var_name='Year',
    value_name='Consumption'
)
```

---

## Exercise 2.4 | Pivot to Wide
<p class="subheader">Convert long format back to wide format</p>

```{.python}
# Pivot back to wide format
percap_wide = percap_long.pivot(
    index='Code',
    columns='Year',
    values='Consumption'
)
```

