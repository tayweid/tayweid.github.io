---
format:
  revealjs:
    css: custom.css
    transition: none
---

## ECON 0150 | Economic Data Analysis {.center}
<p class="subheader-center">The economist's data analysis pipeline.</p>

<br> 

### *Part 1.6 | Transforming Data*

---

## Exercise 1.6 | Starbucks' Global Server Capacity
<p class="subheader">How many shops are open at any given time?</p>

<br><br>

- Starbucks manages many shops globally and needs to maintain server capacity for all of them around the clock.

. . .

- We want to investigate how many coffee shops are open at any given hour to better understand server loads and Starbucks' global capacity needs.

. . .

- It's also just pretty interesting.

---

## Exercise 1.6 | Starbucks' Global Server Capacity
<p class="subheader">How many shops are open at any given time?</p>

Looking at the data is a good place to start.

<br>

```{python}
# Import packages
import pandas as pd

# Load data
hours = pd.read_csv('data/Starbucks_Location_Hours.csv')
hours[['country', 'open', 'close', 'timezone']].head()
```

. . .

<br>

*>as is common, it's difficult to understand the raw data on its own*

---

## Server Capacity: Local Opening Times
<p class="subheader">What times do shops open in their local times?</p>

Lets start by looking at what times shops open in local time.

. . .

```{.python}
# Histogram of opening times
plt.hist(hours.open)
```

. . .

![](i/i_01.png)

. . .

*> but does this tell us how many shops are open at one time?*

---

## Server Capacity: Global Opening Times
<p class="subheader">What times do shops open (GMT)?</p>

Lets standardize all times in *Greenwich Mean Time* (GMT).

. . .

```{.python}
# Normalize to GMT
hours['open_GMT_simple'] = hours['open'] - hours['timezone']

# Histogram of opening times (GMT)
plt.hist(hours.open_GMT_simple)
```

. . .

![](i/i_02.png)

. . .

*> what do the negative values mean?*

. . .

*> hour -1 (1 hour before GMT midnight) is the same as opening at hour 23*

---

## Server Capacity: Standardizing Hours
<p class="subheader">Normalize the negative values to 24 hours.</p>

Lets add 24 if the number is negative.

. . .

```{.python}
# Normalize to 24 hours
hours['open_GMT'] = hours['open_GMT_simple'].mod(24)
```

. . .

![](i/i_03.png)

---

## Server Capacity: Local Closing Times
<p class="subheader">What times do shops close in their local times?</p>

Next lets examine what times shops close in their local time.

. . .

```{.python}
# Histogram of opening times
plt.hist(hours.close)
```

. . .

![](i/i_04.png)

. . .

*> but lets standardize this too*

---

## Location Hours: Global Closing Times
<p class="subheader">What times do shops close (GMT)?</p>

```{.python}
# Normalize to GMT
hours['close_GMT_simple'] = hours['close'] - hours['timezone']

# Histogram of opening times (GMT)
plt.hist(hours.close_GMT_simple)
```

![](i/i_05.png)

. . .

*> here we have another issue, that some values are greater than 24*

---

## Location Hours: Global Closing Times
<p class="subheader">Normalize values to 24 hours.</p>

Lets add 24 if the number is negative and subtract 24 if the number is above 23.

. . .

```{.python}
# Normalize to 24 hours
hours['close_GMT'] = hours['close_GMT_simple'].mod(24)
```

. . .

![](i/i_06.png)

---

## Location Hours
<p class="subheader">So, how many locations are open at each hour of the day? </p>

![](i/i_06.png)

. . .

*> this only tells us openings and closings at each hour, not total open*

. . .

*> instead, lets sum up all the shops that have opened <b>that day</b>*

---

## Location Hours
<p class="subheader">So, how many locations are open at each hour of the day? </p>

*> lets sum up all the shops that have opened <b>that day</b>*

. . .

```{.python}
# Construct values by bin
opened_values = hours['open_GMT'].value_counts().sort_index()

# Cumulative sum
total_opened = opened_values.cumsum()
```

. . .

![](i/i_07.png)

---

## Location Hours
<p class="subheader">So, how many locations are open at each hour of the day? </p>

![](i/i_07.png)

*> from here, to find the total that have opened/closed, we take the difference*

---

## Location Hours
<p class="subheader">So, how many locations are open at each hour of the day? </p>

. . .

```{.python}
# Take the difference
net_increase = total_opened - total_closed
```

. . .

![](i/i_08.png)

. . .

*> why is the green line negative?*

. . .

*> lets add the number open at midnight (GMT).*


---

## Location Hours
<p class="subheader">So, how many locations are open at each hour of the day? </p>

. . .

```{.python}
# Add those open at midnight
count_open_after_close = len(hours[hours['open_GMT'] >= hours['close_GMT']])
cumulative_open = net_increase + count_open_after_close
```

. . .

![](i/i_09.png)