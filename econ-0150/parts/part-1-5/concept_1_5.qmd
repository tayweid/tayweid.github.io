---
format:
  revealjs:
    css: custom.css
    transition: none
---

## ECON 0150 | Economic Data Analysis {.center}
<p class="subheader-center">The economist's data analysis skillset.</p>

<br>

### *Part 1.5 | Panel Data (Wide Format)*

---

## Recap Part 1.4 | Long Format Panel Data
<p class="subheader">Each row represents an observation of an entity at one point in time</p>

. . .

<br>

| Code | Year | Consumption |
|------|------|-------------|
| AUT | 1990 | 10.47 |
| AUT | 1991 | 10.07 |
| AUT | 1992 | 9.27 |
| AUT | 1993 | 10.13 |
| AUT | 1994 | 8.21 |
| ... | ... | ... |

*> this is data on coffee consumption per capita, 34 countries, 1990 to 2019*

---

## Question
<p class="subheader">Is the world drinking more coffee in 2019 than in 1999?</p>

<br>

| Code | Year | Consumption |
|------|------|-------------|
| AUT | 1990 | 10.47 |
| AUT | 1991 | 10.07 |
| AUT | 1992 | 9.27 |
| AUT | 1993 | 10.13 |
| AUT | 1994 | 8.21 |
| ... | ... | ... |

. . .

*> how can we use this data to answer our question?*

. . .

*> it's challenging... lets instead use one row per **Entitiy***

---

## Wide Format Panel Data
<p class="subheader">A row for each entity across many column time periods</p>

. . .

<br>

| Code | 1999 | 2004 | 2009 | 2014 | 2019 |
|------|------|------|------|------|------|
| AUT | 8.43 | 7.31 | 6.37 | 7.97 | 7.93 |
| BGR | 2.65 | 2.83 | 3.30 | 3.12 | 3.64 |
| HRV | 4.48 | 5.16 | 5.10 | 5.21 | 5.62 |
| CYP | 3.48 | 3.53 | 4.05 | 4.13 | 5.62 |
| CZE | 3.26 | 3.56 | 3.02 | 5.69 | 4.74 |
| ... | ... | ... | ... | ... | ... |

. . .

*> now comparing 1999 vs 2019 is just comparing two columns!*

---

## Wide Format
<p class="subheader">Each year is a column</p>

![](i/w_01.png)

## Long Format
<p class="subheader">Each observation is a row</p>

![](i/w_02.png)

---

## Two Formats, Same Data
<p class="subheader">Panel data can be stored in two ways</p>

<br>

::: {.incremental}
- **Wide format:** Each time period is a separate column
- **Long format:** Each observation is a separate row
- Same information, different shapes
- Different shapes make different tasks easier
:::

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

Lets examine whether the world is drinking more coffee today than in the 1990s.

- **Data:** `Coffee_Per_Cap.csv`

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_03.png)

. . .

*> compared to what...?*

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_04.png)

. . .

*> this is still pretty unclear: histograms aren't great for comparison*

. . .

*> lets use a multi-boxplot*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_05.png)

. . .

*> this is better: it looks like the distribution is shifted higher!*

. . .

*> lets examine the years in between to see how the distribution evolved*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_06_c.png)

. . .

*> lets ask some smaller more focussed questions*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_07.png)

*> focus on the medians*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_11.png)

*> ... when the median is above 5 kg per cap*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years saw the largest jump in the median?</p>

![](i/i_07.png)

*> ... a little difficult to see*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years saw the largest jump in the median?</p>

![](i/i_08.png)

*> ... a little difficult to see*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the country with the lowest consumption consuming more today?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the country with the lowest consumption consuming more today?</p>

![](i/i_09.png)

*> focus on the minimums*

. . .

*> yes!*

---

## Panel Data: Multi-Boxplots
<p class="subheader">What patterns do we observe about the maximums?</p>

![](i/i_10.png)

*> same with the maximums*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_12.png)

. . .

*> look at the 25%*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_12.png)

*> look at the 25% and compare it to 5 kg per cap*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_13.png)

*> all of them*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_06.png)

. . .

*> look at the range*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_14.png)

*> look at the range*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_15.png)

*> look at the range and select the largest*

---

## Exercise 1.5 | Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

We're going to use a set of boxplots to visually compare across years the distributions of coffee consumption per capital among coffee importing countries.

- **Data:** `Coffee_Per_Cap.csv`

. . .

| Code | 1999 | 2009 | 2019 |
|------|------|------|------|
| AUT | 8.43 | 6.37 | 7.93 |
| BGR | 2.65 | 3.30 | 3.64 |
| HRV | 4.48 | 5.10 | 5.62 |
| CYP | 3.48 | 4.05 | 5.62 |
| CZE | 3.26 | 3.02 | 4.74 |
| ... | ... | ... | ... |

. . .

*> this is **Wide-Format Panel Data**: each year is in a separate column*


---

## Exercise 1.5 | Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

With wide-format panel data seaborn looks a little different.

```{.python}
# Wide Format Multi-Boxplot
percap_selected = percap[['1999','2009','2019']]
sns.boxplot(percap_selected, orient='h', whis=(0, 100))
```

. . .

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">In which year did most countries increase their coffee consumption?</p>

![](i/i_06_c.png)

. . .

*> not visible in the figure!*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_06_c.png)

. . .

*> also not visible with this figure!*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_05.png)

. . .

*> better, but this figure still doesn't let us keep track of countries between years...*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_16.png)

. . .

*> a scatter plot can visualize changes between two points in time*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_17.png)

*> a 45 degree line shows all the possible points with no change*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_18.png)

*> points above the line increased*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries decreased their coffee consumption between 1999 and 2019?</p>

![](i/i_19.png)

*> points below the line decreased*

---

## Panel Data: Relationships Between Years
<p class="subheader">Does the data confirm that the world is drinking more coffee?</p>

![](i/i_20.png)

*> we can use colors to visualize both increases and decreases*

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

We're going to use a scatterplot to visually examine how countries' coffee consumption changed between 1999 and 2019.

- **Data:** `Coffee_Per_Cap.csv`

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

```{.python}
# Wide Format Scatterplot
sns.scatterplot(percap, x='1999', y='2019')
```

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

```{.python}
# Wide Format Scatterplot
sns.scatterplot(percap, x='1999', y='2019')
```

![](i/i_16.png)

---

## Counting Changes
<p class="subheader">How many countries increased vs decreased?</p>

![](i/i_20.png)

. . .

*> we can see visually that most points are above the 45° line*

. . .

*> but how do we count exactly how many?*

---

## Counting Changes
<p class="subheader">How many countries increased vs decreased?</p>

1. **Create a change column:** Subtract old from new

| Code | 1999 | 2019 | change |
|------|------|------|--------|
| AUT | 8.43 | 7.93 | -0.50 |
| BGR | 2.65 | 3.64 | 0.99 |
| HRV | 4.48 | 5.62 | 1.14 |
| ... | ... | ... | ... |

::: {.incremental}
2. **Filter:** Select rows where change > 0 (or < 0)
3. **Count:** Use `len()` to count the filtered rows
:::

. . .

*> positive change = increased; negative change = decreased*

---

## Exercise 1.5 | Counting Changes
<p class="subheader">How many countries increased their coffee consumption?</p>

```{.python}
# Create a change column
percap['change'] = percap['2019'] - percap['1999']
percap.head()
```

. . .

<br>

```{.python}
# Count countries that increased (change > 0)
increased = percap[percap['change'] > 0]
len(increased)
```

. . .

<br>

```{.python}
# Count countries that decreased (change < 0)
decreased = percap[percap['change'] < 0]
len(decreased)
```

---

## Question
<p class="subheader">How has each country's consumption changed over time?</p>

<br><br>

Instead of measuring changes between two years (1999 and 2019), how might we visualize countrys' full trends over all 30 years?

. . .

<br><br>

*> lets use a line plot with Year on x-axis and Consumption on y-axis, colored by Country*

---

## Question
<p class="subheader">How has each country's consumption changed over time?</p>

The problem is that wide format has no `Year` column!

. . .

<br>

```{.python}
# This won't work!
sns.lineplot(percap, x='Year', y='Consumption', hue='Code')
```

. . .

<br><br>

*> we need to construct a year column*

---

## Reshaping: Wide → Long
<p class="subheader">Turn columns into rows using `melt()`.</p>

![](i/w_03.png)

*> each year column becomes rows in a new `Year` column*

---

## Question
<p class="subheader">How has each country's consumption changed over time?</p>

![](i/w_04.png)

. . .

*> this is possible now using the long format panel data*

---

## Exercise 1.5 | Reshaping
<p class="subheader">How has each country's consumption changed over time?</p>

. . .

Use `melt()` to reshape wide → long.

![](i/w_03_notitle.png)

. . .

```{.python}
# Wide to Long
percap_long = percap.melt(
    id_vars='Code',          # The identifier column
    var_name='Year',         # The new 'melted' column
    value_name='Consumption' # The new 'melted' values
)
```

---

## Exercise 1.5 | Reshaping
<p class="subheader">How has each country's consumption changed over time?</p>

```{.python}
# Now we can plot trends for each country
sns.lineplot(percap_long, x='Year', y='Consumption', hue='Code')
```

![](i/w_04.png)

*> long format makes line plots natural — use `hue='Code'`*

---

## Reshaping: Long → Wide
<p class="subheader">Turn rows into columns using `pivot()`.</p>

<br>

Sometimes data comes in long format but we need wide format *(eg. scatterplots)*.

![](i/w_04_pivot.png)

. . .

Think of `pivot()` as the opposite of `melt()`.

---

## Reshaping: The Code
<p class="subheader">Turn rows into columns using `pivot()`.</p>

Use `pivot()` to reshape long → wide.

![](i/w_04_pivot.png)

. . .

```{.python}
# Long to Wide
percap_wide = percap_long.pivot(
    index='Code',         # The identifier column
    columns='Year',       # The column used to create the new column headers
    values='Consumption'  # The column used to create the new column values
)
```

. . .

*> you'll use this in your homework :)*

---

## Reshaping
<p class="subheader">Choose based on your starting point and goal</p>

The data format should match your visualization goal.

<br>

| Direction | Function | When to use |
|-----------|----------|-------------|
| Wide → Long | `melt()` | Need line plots, faceting |
| Long → Wide | `pivot()` | Need scatterplots |

. . .

- `melt()` turns columns into rows (wide → long)
- `pivot()` turns rows into columns (long → wide)

---

## Part 1.5 | Panel Data (Wide Format)

<br><br>

#### Summary

::: {.incremental}
- **Wide format:** Each time period is a column
- **Multi-boxplots** compare distributions across time
- **Scatterplots with 45° lines** track individual changes
- **Filtering** with `df[df['col'] > 0]` counts subsets
- **melt()** converts wide → long when you need line plots
- **pivot()** converts long → wide when you need boxplots or scatterplots
:::

---

## Building Blocks
<p class="subheader">What this unit adds to your toolkit</p>

| Block | Part 1.5 |
|-------|----------|
| Variables | Numerical |
| Structures | Panel (wide format) |
| Operations | Filter, Reshape (melt, pivot) |
| Visualizations | Multi-boxplot, Scatterplot with 45° line |