---
format:
  revealjs:
    css: custom.css
    transition: none
---

## ECON 0150 | Economic Data Analysis {.center}
<p class="subheader-center">The economist's data analysis skillset.</p>

<br>

### *Part 1.5 | Panel Data (Wide Format)*

---

## Recap: Long Format
<p class="subheader">From Part 1.4</p>

<br>

::: {.incremental}
- **Long format:** Each observation is a row
- A column identifies which group each row belongs to
- Great for: bar charts, histograms, faceting, line graphs
- Use `hue='Group'` and `col='Group'` in seaborn
:::

---

## New Question
<p class="subheader">Is the world drinking more coffee?</p>

<br><br>

We have data on coffee consumption per capita for 34 countries from 1990 to 2019.

. . .

<br>

*> how can we tell if consumption increased between 1999 and 2019?*

---

## The Challenge
<p class="subheader">Comparing specific years in long format</p>

```{python}
import pandas as pd
# Simulate long format data
percap_wide = pd.read_csv('data/Coffee_Per_Cap.csv', index_col=0)
percap_long = percap_wide.melt(id_vars=['Code'], var_name='Year', value_name='Consumption')
percap_long.head(8)
```

. . .

*> to compare 1999 and 2019, we'd need to filter twice and merge...*

. . .

*> there must be a better way!*

---

## What We Want
<p class="subheader">Each year as its own column</p>

<br><br>

::: {.incremental}
- Instead of years being *values* in a column...
- We want years to be *column names*
- Then comparing 1999 vs 2019 is just comparing two columns!
:::

---

## Wide Format Panel Data
<p class="subheader">Each time period is a column</p>

```{python}
import pandas as pd
percap = pd.read_csv('data/Coffee_Per_Cap.csv', index_col=0)
percap[['Code', '1999', '2004', '2009', '2014', '2019']].head()
```

. . .

*> now comparing 1999 vs 2019 is just comparing two columns!*

---

## Two Formats, Same Data
<p class="subheader">Recall: panel data can be stored in two ways</p>

<br>

::: {.incremental}
- **Wide format:** Each time period is a separate column
- **Long format:** Each observation is a separate row
- Same information, different shapes
- Different shapes make different tasks easier
:::

---

## Wide Format
<p class="subheader">Each year is a column</p>

![](i/w_01.png)

*> familiar from Part 1.4 — countries as rows, years as columns*

---

## Long Format
<p class="subheader">Each observation is a row</p>

![](i/w_02.png)

*> same data, but now each country-year combination is a row*

---

## Reshaping: Two Directions
<p class="subheader">We can convert between formats</p>

<br>

::: {.incremental}
- **Wide → Long:** called "melting" or "unpivoting"
- **Long → Wide:** called "pivoting" or "spreading"
- Python pandas: `melt()` and `pivot()`
:::

---

## Melting: Wide → Long
<p class="subheader">Turn columns into rows</p>

![](i/w_03.png)

*> each year column becomes rows in a new "Year" column*

---

## Melting: The Code
<p class="subheader">Use `melt()` to reshape wide → long</p>

```{.python}
# Wide to Long
long_df = wide_df.melt(
    id_vars=['Code'],       # Keep as identifier columns
    var_name='Year',        # Name for the former column headers
    value_name='Consumption' # Name for the values
)
```

. . .

*> `id_vars` = columns to keep, everything else gets melted*

---

## Melting: The Result
<p class="subheader">Now we can plot all years easily</p>

![](i/w_04.png)

. . .

*> long format makes line plots natural — use `hue='Code'`*

---

## Pivoting: Long → Wide
<p class="subheader">Turn rows into columns</p>

![](i/w_05.png)

*> each unique Year value becomes its own column*

---

## Pivoting: The Code
<p class="subheader">Use `pivot()` to reshape long → wide</p>

```{.python}
# Long to Wide
wide_df = long_df.pivot(
    index='Code',           # What becomes rows
    columns='Year',         # What becomes columns
    values='Consumption'    # What fills the cells
)
```

. . .

*> we're back to our original wide format*

---

## Pivoting: The Result
<p class="subheader">Now we can compare specific years easily</p>

![](i/w_06.png)

. . .

*> wide format makes scatterplots of Year1 vs Year2 natural*

---

## When to Use Which Format
<p class="subheader">Choose based on what you're trying to do</p>

<br>

| Task | Better Format |
|------|---------------|
| Line plot over time | Long |
| Faceted plots by group | Long |
| Compare two specific years | Wide |
| Scatterplot (Year1 vs Year2) | Wide |

---

## When to Use Which Format
<p class="subheader">The key insight</p>

<br>

::: {.incremental}
- **Long format:** Good when you want to *group by* or *color by* a variable
- **Wide format:** Good when you want to *compare* or *correlate* specific columns
- Neither is "better" — it depends on your task
:::

---

## Exercise 1.5 | Reshaping
<p class="subheader">Practice converting between formats</p>

```{.python}
# Load wide format data
percap = pd.read_csv('data/Coffee_Per_Cap.csv')

# Melt to long format
percap_long = percap.melt(
    id_vars=['Code'],
    var_name='Year',
    value_name='Consumption'
)
```

---

## Exercise 1.5 | Reshaping
<p class="subheader">Practice converting between formats</p>

```{.python}
# Pivot back to wide format
percap_wide = percap_long.pivot(
    index='Code',
    columns='Year',
    values='Consumption'
)
```

---

## Per Capita Transformations
<p class="subheader">Which country has the **largest economy**?</p>

![](i/i_01.png)

. . .

*> the US and China dominate — their economies are massive*

---

## Per Capita Transformations
<p class="subheader">Which country is **richest**?</p>

![](i/i_01.png)

*> wait — is "largest economy" the same as "richest"?*

---

## Per Capita Transformations
<p class="subheader">Which country is **richest**?</p>

![](i/i_02.png)

. . .

*> dividing by population completely changes the picture!*

---

## Per Capita Transformations
<p class="subheader">Which country is **richest**?</p>

![](i/i_02.png)

*> Luxembourg, Switzerland, Norway — small populations, high living standards*

---

## Exercise 1.5 | Per Capita Transformation
<p class="subheader">How does dividing by population change the ranking?</p>

<br><br>

Lets transform total GDP to GDP per capita.

- **Data:** `GDP_Population_2019.csv`

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

Lets examine whether the world is drinking more coffee today than in the 1990s.

- **Data:** `Coffee_Per_Cap.csv`

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_03.png)

. . .

*> compared to what...?*

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_04.png)

. . .

*> this is still pretty unclear: histograms aren't great for comparison*

. . .

*> lets use a multi-boxplot*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_05.png)

. . .

*> this is better: it looks like the distribution is shifted higher!*

. . .

*> lets examine the years in between to see how the distribution evolved*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_06_c.png)

. . .

*> lets ask some smaller more focussed questions*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_07.png)

*> focus on the medians*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_11.png)

*> ... when the median is above 5 kg per cap*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years saw the largest jump in the median?</p>

![](i/i_07.png)

*> ... a little difficult to see*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years saw the largest jump in the median?</p>

![](i/i_08.png)

*> ... a little difficult to see*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the country with the lowest consumption consuming more today?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the country with the lowest consumption consuming more today?</p>

![](i/i_09.png)

*> focus on the minimums*

. . .

*> yes!*

---

## Panel Data: Multi-Boxplots
<p class="subheader">What patterns do we observe about the maximums?</p>

![](i/i_10.png)

*> same with the maximums*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_12.png)

. . .

*> look at the 25%*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_12.png)

*> look at the 25% and compare it to 5 kg per cap*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_13.png)

*> all of them*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_06.png)

. . .

*> look at the range*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_14.png)

*> look at the range*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_15.png)

*> look at the range and select the largest*

---

## Exercise 1.5 | Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

We're going to use a set of boxplots to visually compare across years the distributions of coffee consumption per capital among coffee importing countries.

- **Data:** `Coffee_Per_Cap.csv`

. . .

```{python}
import pandas as pd
percap = pd.read_csv('data/Coffee_Per_Cap.csv', index_col=0)
percap[['Code', '1999', '2009','2019']].head()
```

. . .

*> this is **Wide-Format Panel Data**: each year is in a separate column*


---

## Exercise 1.5 | Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

With wide-format panel data seaborn looks a little different.

```{.python}
# Wide Format Multi-Boxplot
sns.boxplot(percap[['1999','2004','2009','2014','2019']], orient='h', whis=(0, 100))
```

. . .

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">In which year did most countries increase their coffee consumption?</p>

![](i/i_06_c.png)

. . .

*> not visible in the figure!*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_06_c.png)

. . .

*> also not visible with this figure!*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_05.png)

. . .

*> better, but this figure still doesn't let us keep track of countries between years...*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_16.png)

. . .

*> a scatter plot can visualize changes between two points in time*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_17.png)

*> a 45 degree line shows all the possible points with no change*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_18.png)

*> points above the line increased*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries decreased their coffee consumption between 1999 and 2019?</p>

![](i/i_19.png)

*> points below the line decreased*

---

## Panel Data: Relationships Between Years
<p class="subheader">Does the data confirm that the world is drinking more coffee?</p>

![](i/i_20.png)

*> we can use colors to visualize both increases and decreases*

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

We're going to use a scatterplot to visually examine how countries' coffee consumption changed between 1999 and 2019.

- **Data:** `Coffee_Per_Cap.csv`

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

```{.python}
# Wide Format Scatterplot
sns.scatterplot(percap, x='1999', y='2019')
```

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

```{.python}
# Wide Format Scatterplot
sns.scatterplot(percap, x='1999', y='2019')
```

![](i/i_16.png)

---

## Part 1.5 | Panel Data (Wide Format)

<br><br>

#### Summary

::: {.incremental}
- **Wide format:** Each time period is a column
- **melt()** converts wide → long (columns become rows)
- **pivot()** converts long → wide (rows become columns)
- **Per capita** transformations divide by population
- **Multi-boxplots** compare distributions across time
- **Scatterplots with 45° lines** track individual changes
:::

---

## Long vs Wide: The Complete Picture
<p class="subheader">Choose format based on your task</p>

<br>

**Long Format (Part 1.4)**

- Comparing groups at a point in time
- Faceting, line graphs, groupby
- `hue='Group'`, `col='Group'`

**Wide Format (Part 1.5)**

- Comparing time periods for the same units
- Boxplots, scatterplots, correlations
- Each column is a time period

