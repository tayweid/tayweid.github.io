---
format:
  revealjs:
    css: custom.css
    transition: none
---

## ECON 0150 | Economic Data Analysis {.center}
<p class="subheader-center">The economist's data analysis skillset.</p>

<br>

### *Part 1.5 | Panel Data (Wide Format)*

---

## Recap Part 1.4 | Long Format Panel Data
<p class="subheader">Each row represents an observation of an entity at one point in time</p>

<br>

::: {.incremental}
- **Long format:** Each observation is a row
- A column identifies the entity
:::


---

## Recap Part 1.4 | Long Format Panel Data
<p class="subheader">Each row represents an observation of an entity at one point in time</p>

<br>

Data on coffee consumption per capita for 34 countries from 1990 to 2019.

<br>

| Code | Year | Consumption |
|------|------|-------------|
| AUT | 1990 | 10.47 |
| AUT | 1991 | 10.07 |
| AUT | 1992 | 9.27 |
| AUT | 1993 | 10.13 |
| AUT | 1994 | 8.21 |
| ... | ... | ... |

---

## New Question
<p class="subheader">Is the world drinking more coffee?</p>

<br>

Data on coffee consumption per capita for 34 countries from 1990 to 2019.

<br>

| Code | Year | Consumption |
|------|------|-------------|
| AUT | 1990 | 10.47 |
| AUT | 1991 | 10.07 |
| AUT | 1992 | 9.27 |
| AUT | 1993 | 10.13 |
| AUT | 1994 | 8.21 |
| ... | ... | ... |

. . .

*> how can we tell if consumption increased between 1999 and 2019?*

---

## Wide Format Panel Data
<p class="subheader">A row for each entity across many column time periods</p>

| Code | 1999 | 2004 | 2009 | 2014 | 2019 |
|------|------|------|------|------|------|
| AUT | 8.43 | 7.31 | 6.37 | 7.97 | 7.93 |
| BGR | 2.65 | 2.83 | 3.30 | 3.12 | 3.64 |
| HRV | 4.48 | 5.16 | 5.10 | 5.21 | 5.62 |
| CYP | 3.48 | 3.53 | 4.05 | 4.13 | 5.62 |
| CZE | 3.26 | 3.56 | 3.02 | 5.69 | 4.74 |
| ... | ... | ... | ... | ... | ... |

. . .

*> now comparing 1999 vs 2019 is just comparing two columns!*

---

## Wide Format
<p class="subheader">Each year is a column</p>

![](i/w_01.png)

## Long Format
<p class="subheader">Each observation is a row</p>

![](i/w_02.png)

---

## Two Formats, Same Data
<p class="subheader">Panel data can be stored in two ways</p>

<br>

::: {.incremental}
- **Wide format:** Each time period is a separate column
- **Long format:** Each observation is a separate row
- Same information, different shapes
- Different shapes make different tasks easier
:::

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

Lets examine whether the world is drinking more coffee today than in the 1990s.

- **Data:** `Coffee_Per_Cap.csv`

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_03.png)

. . .

*> compared to what...?*

---

## Panel Data: Coffee Consumption Per Capita
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_04.png)

. . .

*> this is still pretty unclear: histograms aren't great for comparison*

. . .

*> lets use a multi-boxplot*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_05.png)

. . .

*> this is better: it looks like the distribution is shifted higher!*

. . .

*> lets examine the years in between to see how the distribution evolved*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

![](i/i_06_c.png)

. . .

*> lets ask some smaller more focussed questions*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_07.png)

*> focus on the medians*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years show at least half consuming less than 5 kg per cap?</p>

![](i/i_11.png)

*> ... when the median is above 5 kg per cap*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years saw the largest jump in the median?</p>

![](i/i_07.png)

*> ... a little difficult to see*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years saw the largest jump in the median?</p>

![](i/i_08.png)

*> ... a little difficult to see*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the country with the lowest consumption consuming more today?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Is the country with the lowest consumption consuming more today?</p>

![](i/i_09.png)

*> focus on the minimums*

. . .

*> yes!*

---

## Panel Data: Multi-Boxplots
<p class="subheader">What patterns do we observe about the maximums?</p>

![](i/i_10.png)

*> same with the maximums*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_12.png)

. . .

*> look at the 25%*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_12.png)

*> look at the 25% and compare it to 5 kg per cap*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which years did more than 25% consume less than 5 kg?</p>

![](i/i_13.png)

*> all of them*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_06.png)

. . .

*> look at the range*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_14.png)

*> look at the range*

---

## Panel Data: Multi-Boxplots
<p class="subheader">Which year saw the greatest difference between any two countries?</p>

![](i/i_15.png)

*> look at the range and select the largest*

---

## Exercise 1.5 | Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

We're going to use a set of boxplots to visually compare across years the distributions of coffee consumption per capital among coffee importing countries.

- **Data:** `Coffee_Per_Cap.csv`

. . .

| Code | 1999 | 2009 | 2019 |
|------|------|------|------|
| AUT | 8.43 | 6.37 | 7.93 |
| BGR | 2.65 | 3.30 | 3.64 |
| HRV | 4.48 | 5.10 | 5.62 |
| CYP | 3.48 | 4.05 | 5.62 |
| CZE | 3.26 | 3.02 | 4.74 |
| ... | ... | ... | ... |

. . .

*> this is **Wide-Format Panel Data**: each year is in a separate column*


---

## Exercise 1.5 | Multi-Boxplots
<p class="subheader">Is the world drinking more coffee?</p>

With wide-format panel data seaborn looks a little different.

```{.python}
# Wide Format Multi-Boxplot
sns.boxplot(percap[['1999','2004','2009','2014','2019']], orient='h', whis=(0, 100))
```

. . .

![](i/i_06.png)

---

## Panel Data: Multi-Boxplots
<p class="subheader">In which year did most countries increase their coffee consumption?</p>

![](i/i_06_c.png)

. . .

*> not visible in the figure!*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_06_c.png)

. . .

*> also not visible with this figure!*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_05.png)

. . .

*> better, but this figure still doesn't let us keep track of countries between years...*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_16.png)

. . .

*> a scatter plot can visualize changes between two points in time*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_17.png)

*> a 45 degree line shows all the possible points with no change*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries increased their coffee consumption between 1999 and 2019?</p>

![](i/i_18.png)

*> points above the line increased*

---

## Panel Data: Relationships Between Years
<p class="subheader">How many countries decreased their coffee consumption between 1999 and 2019?</p>

![](i/i_19.png)

*> points below the line decreased*

---

## Panel Data: Relationships Between Years
<p class="subheader">Does the data confirm that the world is drinking more coffee?</p>

![](i/i_20.png)

*> we can use colors to visualize both increases and decreases*

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

We're going to use a scatterplot to visually examine how countries' coffee consumption changed between 1999 and 2019.

- **Data:** `Coffee_Per_Cap.csv`

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

```{.python}
# Wide Format Scatterplot
sns.scatterplot(percap, x='1999', y='2019')
```

---

## Exercise 1.5 | Scatterplots
<p class="subheader">Is the world drinking more coffee?</p>

```{.python}
# Wide Format Scatterplot
sns.scatterplot(percap, x='1999', y='2019')
```

![](i/i_16.png)

---

## A New Question
<p class="subheader">How has each country's consumption changed over time?</p>

<br><br>

We've compared distributions across years and tracked changes between 1999 and 2019.

. . .

But what if we want to see each country's full trend over all 30 years?

. . .

*> we need a line plot with Year on x-axis and Consumption on y-axis, colored by Country*

---

## The Problem
<p class="subheader">Wide format doesn't work for line plots</p>

<br>

In wide format, years are **column names**, not values in a column.

. . .

```{.python}
# This won't work — there's no 'Year' column!
sns.lineplot(percap, x='Year', y='Consumption', hue='Code')
```

. . .

*> we need to reshape from wide to long format*

---

## Reshaping: Wide → Long
<p class="subheader">Use `melt()` to turn columns into rows</p>

![](i/w_03.png)

*> each year column becomes rows in a new "Year" column*

---

## Reshaping: The Code
<p class="subheader">Use `melt()` to reshape wide → long</p>

```{.python}
# Wide to Long
percap_long = percap.melt(
    id_vars=['Code'],        # Keep as identifier columns
    var_name='Year',         # Name for the former column headers
    value_name='Consumption' # Name for the values
)
```

. . .

*> `id_vars` = columns to keep, everything else gets melted*

---

## Exercise 1.5 | Reshaping
<p class="subheader">How has each country's consumption changed over time?</p>

```{.python}
# Reshape wide to long
percap_long = percap.melt(
    id_vars=['Code'],
    var_name='Year',
    value_name='Consumption'
)
```

. . .

```{.python}
# Now we can plot trends for each country
sns.lineplot(percap_long, x='Year', y='Consumption', hue='Code')
```

---

## Exercise 1.5 | Reshaping
<p class="subheader">How has each country's consumption changed over time?</p>

![](i/w_04.png)

*> long format makes line plots natural — use `hue='Code'`*

---

## Part 1.5 | Panel Data (Wide Format)

<br><br>

#### Summary

::: {.incremental}
- **Wide format:** Each time period is a column
- **Multi-boxplots** compare distributions across time
- **Scatterplots with 45° lines** track individual changes
- **melt()** converts wide → long when you need line plots
:::

---

## Long vs Wide: The Complete Picture
<p class="subheader">Choose format based on your task</p>

<br>

**Long Format (Part 1.4)**

- Comparing groups at a point in time
- Faceting, line graphs, groupby
- `hue='Group'`, `col='Group'`

**Wide Format (Part 1.5)**

- Comparing time periods for the same units
- Boxplots, scatterplots, correlations
- Each column is a time period

