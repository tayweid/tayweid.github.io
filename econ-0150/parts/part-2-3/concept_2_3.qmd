---
format:
  revealjs:
    css: custom.css
    transition: none
---

## ECON 0150 | Economic Data Analysis {.center}
<p class="subheader-center">The economist's data analysis pipeline.</p>

<br> 

### *Part 2.3 | Filtering Data*

---

## A New US Coffee Shop
<p class="subheader">Lets use Starbucks_Location_Hours.csv to inform a new shop's hours.</p>

<br><br>

- The coffee shop is opening in upstate New York, near the border to Canada.
- You're asked to help make some decisions about how to run the shop when it opens.
- The dataset `Starbucks_Location_Hours.csv` contains information about Starbucks coffee shops globally.

---

## A New Coffee Shop
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

. . .

```{python}
import pandas as pd
# Load the data
data = pd.read_csv('data/Starbucks_Location_Hours.csv')
#data.head()
data[['storeNumber', 'COUNTRY_CODE', 'open', 'close', 'duration_hr']].head()
```

. . .

<br>

*> we should use a figure*

---

## A New Coffee Shop
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_01.png)

. . .

*> so it seems best to open sometime in the morning...  makes sense*

. . .

*> but what if there's something specific about US coffee drinkers though?*

---

## Opening Time: filter by category
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_02.png)

*> here we've filtered for US locations*

. . .

*> so it seems US Starbucks open earlier*

---

## Opening Time: filter by category
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_02.png)

*> but maybe we should look at Canadian shops too...*

. . .

*> let filter for **BOTH** countries*

---

## Opening Time: combining filters
<p class="subheader">Lets us some Boolian logic :)</p>

![](i/i_Bool.png)

. . .

*> is there something different between the US and Canada?*

---

## Opening Time: combining filters
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_02.png)

---

## Opening Time: combining filters
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_03.png)

. . .

*> so not much difference between when shops in the US and Canada open*

---

## Opening Time: combining filters
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_03_question.png)

---

## Opening Time: combining filters
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_03_answer.png)

*> no data! no coffee shop can be in the US AND Canada!*

---

## Opening Time: combining filters
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_03.png)

---

## Opening Time: combining filters
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

![](i/i_04.png)

. . .

*> so coffee shops in US and Canada open much earlier than the rest of the world*

---

## Opening Time: conclusions
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

<br>

- So lets open earlier than 7 AM.


---

## Exercise 2.3 | Filter by Category
<p class="subheader">Use Starbucks_Location_Hours.csv to inform a new shop's hours.</p>

<br><br>

- The coffee shop is opening in upstate New York, near the border to Canada.
- You're asked to help make some decisions about how to run the shop when it opens.
- The dataset `Starbucks_Location_Hours.csv` contains information about Starbucks coffee shops globally.

---

## Coffee Shop Hours: filter by category
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

---

## Coffee Shop Hours: plot all opening times
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

```{.python}
# Histogram
sns.histplot(hours, x='open', bins=range(0,25,1))
```

. . .

![](i/i_01.png)

---

## Filtering Data by Category
<p class="subheader">Filtering categorical data requires logical operations.</p>

| Logic | Python | | Example |
|-----------|--------|--|---------|
| Equals | == | | `df[df['shop'] == 'A']` |
| Unequal | != | | `df[df['shop'] != 'A']` |
| NOT | ~ | | `df[~(df['shop'] == 'A')]` |
| In list | .isin() | | `df[df['shop'].isin(['A', 'B'])]` |
| AND | & | | `(df['shop'] == 'A') & (df['open'] < 7)` |
| OR | \| | | `(df['shop'] == 'A') | (df['open'] < 7)` |

---

## Coffee Shop Hours: filter for US locations
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

```{.python}
# Decide whether each row's country code is 'US'
us_codes = (hours['COUNTRY_CODE'] == 'US')
```

---

## Coffee Shop Hours: filter for US locations
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

```{.python}
# Decide whether each row's country code is 'US'
us_codes = (hours['COUNTRY_CODE'] == 'US')

# Select the rows with True
us_hours = hours[us_codes]
```

---

## Coffee Shop Hours: filter for US locations
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

```{.python}
# Select the rows with country code equal to 'US'
us_hours = hours[hours['COUNTRY_CODE'] == 'US']
```

---

## Coffee Shop Hours: filter for US locations
<p class="subheader">Q. When might be a good time for the coffee shop to open?</p>

```{.python}
# Histogram of US locations
sns.histplot(us_hours, x='open', bins=range(0,25,1))
```

![](i/i_02.png)

---

## Coffee Shop Hours: shops in either US or CA
<p class="subheader">Q. When might be a good time for a US coffee shop to open?</p>

```{.python}
# Find the data in either the US or in Canada (CA)
# Method 1: Using OR operator |
us_ca = hours[(hours['COUNTRY_CODE'] == 'US') | (hours['COUNTRY_CODE'] == 'CA')]
```

---

## Coffee Shop Hours: shops in either US or CA
<p class="subheader">Q. When might be a good time for a US coffee shop to open?</p>

```{.python}
# Find the data in either the US or in Canada (CA)
# Method 2: Using isin()
us_ca = hours[hours['COUNTRY_CODE'].isin(['US', 'CA'])]
```

---

## Coffee Shop Hours: shops in either US or CA
<p class="subheader">Q. When might be a good time for a US coffee shop to open?</p>

```{.python}
# Create histogram
sns.histplot(us_ca, x='open', bins=range(0,25,1))

```

![](i/i_03.png)

---

## Coffee Shop Hours: shops in both US and CA
<p class="subheader">Q. When might be a good time for a US coffee shop to open?</p>

What would this dataset look like?

```{.python code-line-numbers="4,7"}
hours[(hours['COUNTRY_CODE'] == 'US') & (hours['COUNTRY_CODE'] == 'CN')]
```

. . .

*> it would contain no data!*

![](i/i_03_answer.png)

---

## Opening Time
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

<br>

- So lets open earlier than 7 AM.
- How long should we stay open?

. . .

```{python}
import pandas as pd
# Load the data
data = pd.read_csv('data/Starbucks_Location_Hours.csv')
#data.head()
data[['storeNumber', 'COUNTRY_CODE', 'open', 'close', 'duration_hr']].head()
```

---

## Duration
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_05.png)

. . .

*> so most shops stay open for around 15 hours*

. . .

*> does that mean we should stay open for 15 hours?*

---

## Duration: filter by inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

| Symbol | Meaning |
|--------|--------------|
| = | Equal to |
| ≠ | Not equal to |
| < | Less than |
| > | Greater than |
| ≤ | Less than or equal to |
| ≥ | Greater than or equal to |

---

## Duration: filter by inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_05.png)

*> lets filter for coffee shops that open before 7 AM*

---

## Duration: filter by inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

How would we filter for coffee shops that open before 7 AM?

<br>

```{python}
import pandas as pd
# Load the data
data = pd.read_csv('data/Starbucks_Location_Hours.csv')
#data.head()
data[['storeNumber', 'COUNTRY_CODE', 'open', 'close', 'duration_hr']].head()
```

. . .

*> use "`open` < 7"*

---

## Duration: filter by inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_05.png)

---

## Duration: filter by inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_07.png)

. . .

*> so shops that open early stay open longer*

---

## Duration: filter by inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_06.png)

. . .

*> but here we're looking at all shops globally!*

*> our shop is opening in the US near Canada, so lets filter by country too*

---

## Duration: filter on category and inequality
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_08.png)

. . .

*> shops that open early will stay open longer in the US or Canada*

. . .

*> this is hard to see: maybe there's a more systematic way of showing differences*

---

## Duration: conclusions
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

![](i/i_09.png)

---

## Coffee Shop Hours: recommendation
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

- **Opening time**: Before 7 AM (around 5-6 AM)
- **Duration**: About 16-17 hours (based on early-opening US/CA shops)
- **Closing time**: Around 9-11 PM

. . .

*> this matches what successful coffee shops do in similar markets*

---

## Exercise 2.3 | Filter by Inequality
<p class="subheader">Use Starbucks_Location_Hours.csv to inform a new shop's hours.</p>

---

## Filtering Data by Inequality
<p class="subheader">Filtering numerical data requires inequalities.</p>

| Symbol | Python | | Example |
|--------|--------------|--------------|---------|
| = | == | | `df[df['open'] == 7]` |
| ≠ | != | | `df[df['open'] != 7]` |
| < | < | | `df[df['open'] < 7]` |
| > | > | | `df[df['open'] > 7]` |
| ≤ | <= | | `df[df['open'] <= 7]` |
| ≥ | >= | | `df[df['open'] >= 7]` |

---

## Coffee Shop Hours: filter for early opening shops
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

```{.python}
# Filter for shops that open before 7 AM
early_hours = hours[hours['open'] < 7]
```

---

## Coffee Shop Hours: filter for early opening shops
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

```{.python}
# Create histogram of duration for early-opening shops
sns.histplot(early_hours, x='duration_hr', bins=range(0,25,1))

```

![](i/i_07.png)

---

## Coffee Shop Hours: combine filters
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

```{.python}
# Filter for shops that open early AND are in US or Canada
early_us_ca = hours[(hours['open'] < 7) & (hours['COUNTRY_CODE'].isin(['US', 'CA']))]
```

---

## Coffee Shop Hours: combine filters
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

```{.python}
# Create histogram of duration for early-opening US/CA shops
sns.histplot(early_us_ca, x='duration_hr', bins=range(0,25,1))

```

![](i/i_08.png)

---

## Coffee Shop Hours: compare opening times
<p class="subheader">Q. How long might be good for the coffee shop to stay open?</p>

```{.python}
# Compare early vs all shops in US/CA
sns.histplot(us_ca, x='duration_hr', bins=range(0,25,1), label='All US/CA')
sns.histplot(early_us_ca, x='duration_hr', bins=range(0,25,1), label='Early US/CA')
plt.legend()
```

![](i/i_09.png)


